# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Архитектура приложения "Веб-ларек"

## Архитектурный паттерн: MVP

Проект построен с использованием архитектурного паттерна Model-View-Presenter (MVP):

- **Model (Модель)**: Отвечает за данные и бизнес-логику (`AppState`)
- **View (Представление)**: Отвечает за отображение пользовательского интерфейса (компоненты, наследующие `Component`)
- **Presenter (Представитель)**: Связывает Модель и Представление, обрабатывает действия пользователя и управляет потоком данных (реализован через `EventEmitter`)

## Ключевые базовые классы

### EventEmitter
Реализует шину событий, позволяя компонентам обмениваться информацией без прямого связывания (паттерн "Издатель-подписчик"). Выполняет роль Presenter'а в MVP.

**Ключевые методы**:
- `on(eventName, callback)` - подписка на событие
- `emit(eventName, data)` - генерация события
- `trigger(eventName, context)` - создание функции-триггера
- `off(eventName, callback)` - отписка от события

### Api и WebLarekApi
- `Api` - абстрактный класс для базовой логики HTTP-запросов (`get`, `post`, `handleResponse`)
- `WebLarekApi` - конкретная реализация, наследующая `Api`. Взаимодействует с бэкендом "Веб-ларька"

**Основные методы WebLarekApi**:
- `getCardList()` - получить список товаров
- `getCardItem(id)` - получить товар по ID
- `orderCard(order)` - отправить данные заказа
- Содержит базовый URL для CDN (`cdn`)

### Component<T>
Абстрактный базовый класс для всех UI-компонентов (View).

**Основные методы**:
- `toggleClass(element, className, force)` - переключение классов
- `setText(element, value)` - установка текста
- `setImage(element, src, alt)` - установка изображения
- `setHidden(element)` - скрытие элемента
- `setVisible(element)` - отображение элемента
- `setDisabled(element, state)` - управление состоянием disabled
- `render(data)` - основной метод отрисовки компонента

### Model<T> и AppState
- `Model` - абстрактный класс для моделей данных, содержит метод `emitChanges` для уведомления об изменениях
- `AppState` - конкретная реализация Модели, управляющая состоянием всего приложения

**Хранит**:
- Каталог товаров (`_cardList`)
- Корзину (`_basket`)
- Данные текущего заказа (`_order`)
- ID товара для предпросмотра (`_preview`)
- Ошибки валидации форм (`_formErrors`)

**Основные методы**:
- `setCatalog(items)` - обновление каталога
- `addCardToBasket(item)` - добавление товара в корзину
- `deleteCardToBasket(id)` - удаление товара из корзины
- `setOrderField(field, value)` - установка данных доставки
- `setContactsField(field, value)` - установка контактных данных
- `validateOrder()` - валидация формы доставки
- `validateContacts()` - валидация формы контактов
- `total()` - расчет итоговой суммы

## UI Компоненты (View)

Компоненты, отвечающие за отображение интерфейса (все наследуют `Component`):

### Page
Управляет основной страницей:
- Отображает каталог товаров (`catalog`)
- Показывает счетчик корзины (`counter`)
- Может блокировать прокрутку (`locked`)

### Card
Базовый компонент для карточки товара:
- Категория (`category`)
- Заголовок (`title`)
- Изображение (`image`)
- Цена (`price`)

**Варианты**:
- `CardPreview`: Расширенная версия для модального окна предпросмотра, добавляет полное описание (`text`)
- `CardBasket`: Версия для отображения в корзине, добавляет порядковый номер (`index`) и кнопку удаления

### Basket
Отображает содержимое корзины:
- Список товаров (`items`)
- Общая стоимость (`total`)

### Form<T>
Базовый класс для форм:
- Обработка ввода
- Управление состоянием валидности (`valid`)
- Отображение ошибок (`errors`)

**Варианты**:
- `Order`: Форма для ввода данных доставки (адрес, способ оплаты `payment`)
- `Contacts`: Форма для ввода контактных данных (телефон `phone`, email `email`)

### Success
Компонент для отображения сообщения об успешном оформлении заказа:
- Показывает итоговую сумму (`total`)

### Modal
Управляет модальными окнами:
- Отображает переданный контент (`content`)
- Обеспечивает открытие (`open`) и закрытие (`close`)

## Система событий

Взаимодействие между компонентами построено на событиях, обрабатываемых `EventEmitter`:

### Каталог и Карточки
- `items:changed`: Изменился список товаров
- `card:select`: Пользователь выбрал карточку для просмотра
- `preview:changed`: Открыт/изменен предпросмотр карточки

### Корзина
- `card:add`: Товар добавлен в корзину
- `card:remove`: Товар удален из корзину
- `basket:changed`: Содержимое корзины изменилось
- `counter:changed`: Обновился счетчик товаров в корзине
- `basket:open`: Пользователь открыл корзину

### Заказ и Формы
- `order:open`: Пользователь начал оформление заказа (открыта первая форма)
- `payment:toggle`: Изменен способ оплаты
- `/^order\..*:change/` (Регулярное выражение): Изменилось значение в поле формы доставки
- `/^contacts\..*:change/` (Регулярное выражение): Изменилось значение в поле формы контактов
- `formErrors:change`: Обновились ошибки валидации форм
- `order:submit`: Отправлена форма доставки
- `contacts:submit`: Отправлена форма контактов

### Модальное окно
- `modal:open`: Модальное окно открыто
- `modal:close`: Модальное окно закрыто